import { useState } from "react";
import FullCalendar from "@fullcalendar/react";
import dayGridPlugin from "@fullcalendar/daygrid";
import timeGridPlugin from "@fullcalendar/timegrid";
import interactionPlugin from "@fullcalendar/interaction";
import Sidebar from "../componets/Sidbars/sidebar";

export function CalendarioPage() {
    const [eventos, setEventos] = useState([
        {
            id: "1",
            title: "Visita Técnica - Cliente João",
            start: "2025-08-30T10:00:00",
            end: "2025-08-30T12:00:00",
            setor: "Engenharia",
            backgroundColor: "#204A34",
        },
        {
            id: "2",
            title: "Reunião Comercial - Cliente XPTO",
            start: "2025-09-02T14:00:00",
            end: "2025-09-02T15:00:00",
            setor: "Comercial",
            backgroundColor: "#42CD55",
        },
        {
            id: "3",
            title: "Instalação - Sistema 10kWp",
            start: "2025-09-03T08:00:00",
            end: "2025-09-03T17:00:00",
            setor: "Operacional",
            backgroundColor: "#FF8800",
        },
    ]);

    const handleDateClick = (info: any) => {
        const titulo = prompt("Título do evento:");
        const setor = prompt("Setor (Engenharia, Comercial, Operacional):");

        if (titulo && setor) {
            const start = new Date(info.date);
            const end = new Date(start);
            end.setHours(end.getHours() + 1); // adiciona 1 hora

            setEventos([
                ...eventos,
                {
                    id: String(eventos.length + 1),
                    title: titulo,
                    start: start.toISOString(),
                    end: end.toISOString(),
                    setor,
                    backgroundColor:
                        setor === "Engenharia"
                            ? "#204A34"
                            : setor === "Comercial"
                                ? "#42CD55"
                                : "#FF8800",
                },
            ]);
        }
    };

    return (
        <>
            <Sidebar />


            <div className="ml-16 min-h-screen bg-gray-100 p-8">
                <div className="bg-white rounded-2xl shadow-lg p-6 max-w-6xl mx-auto">
                    <h2 className="text-xl font-semibold text-[#204A34] mb-4">
                        Agenda Unificada
                    </h2>

                    <FullCalendar
                        plugins={[dayGridPlugin, timeGridPlugin, interactionPlugin]}
                        initialView="dayGridMonth"
                        headerToolbar={{
                            left: "prev,next today",
                            center: "title",
                            right: "dayGridMonth,timeGridWeek,timeGridDay",
                        }}
                        events={eventos}
                        dateClick={handleDateClick}
                        editable={true}
                        selectable={true}
                        eventClick={(info) =>
                            alert(
                                `Evento: ${info.event.title}\nSetor: ${info.event.extendedProps.setor
                                }\nInício: ${info.event.start?.toLocaleString()}\nFim: ${info.event.end?.toLocaleString() || "N/A"
                                }`
                            )
                        }
                        height="80vh"
                    />
                </div>
            </div>
        </>
    );
}
